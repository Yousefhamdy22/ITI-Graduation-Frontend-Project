<div class="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100" dir="rtl">
  <!-- Back Button -->
  <div class="sticky top-0 z-10 bg-white border-b border-gray-200 p-4 flex justify-between items-center">
    <button 
      routerLink="/exams" 
      class="text-blue-600 hover:text-blue-800">
      ุงูุนูุฏุฉ
    </button>
    <h1 class="text-2xl font-bold text-gray-800">{{ exam?.title }}</h1>
    <div class="text-2xl font-bold" [ngClass]="timeRemaining <= 60 ? 'text-red-600' : 'text-gray-800'">
      {{ formatTime(timeRemaining) }}
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="flex items-center justify-center min-h-[calc(100vh-100px)]">
    <div class="text-center">
      <div class="animate-spin w-16 h-16 border-4 border-blue-200 border-t-blue-600 rounded-full mx-auto mb-4"></div>
      <p class="text-gray-600">ุฌุงุฑู ุชุญููู ุงูุงุฎุชุจุงุฑ...</p>
    </div>
  </div>

  <!-- Exam Content -->
  <div *ngIf="!loading && exam && !submitted" class="max-w-4xl mx-auto p-6">
    <div class="bg-white rounded-xl shadow-lg p-8">
      <!-- Question Info -->
      <div class="mb-8">
        <div class="flex justify-between items-center mb-4">
          <span class="text-gray-600">ุงูุณุคุงู {{ currentQuestionIndex + 1 }} ูู {{ exam.questions.length }}</span>
          <div class="flex gap-2">
            <button 
              *ngFor="let i of [].constructor(exam.questions.length)"
              [class.bg-blue-600]="i === currentQuestionIndex"
              [class.bg-gray-200]="i !== currentQuestionIndex && !selectedAnswers[i]"
              [class.bg-green-600]="selectedAnswers[i] !== undefined && i !== currentQuestionIndex"
              (click)="currentQuestionIndex = i"
              class="w-8 h-8 rounded text-white text-xs font-bold transition">
              {{ i + 1 }}
            </button>
          </div>
        </div>
        <div class="w-full bg-gray-200 rounded-full h-2">
          <div class="bg-blue-600 h-2 rounded-full transition-all" 
               [style.width.%]="((currentQuestionIndex + 1) / exam.questions.length) * 100"></div>
        </div>
      </div>

      <!-- Question -->
      <div class="mb-8">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">{{ exam.questions[currentQuestionIndex].text }}</h2>

        <!-- Options -->
        <div class="space-y-4">
          <div *ngFor="let option of exam.questions[currentQuestionIndex].options; let i = index"
               (click)="selectAnswer(currentQuestionIndex, i)"
               [class.ring-2]="selectedAnswers[currentQuestionIndex] === i"
               [class.ring-blue-600]="selectedAnswers[currentQuestionIndex] === i"
               [class.bg-blue-50]="selectedAnswers[currentQuestionIndex] === i"
               class="p-4 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50 transition">
            <div class="flex items-center gap-4">
              <div class="w-6 h-6 rounded-full border-2 border-gray-400 flex items-center justify-center"
                   [class.border-blue-600]="selectedAnswers[currentQuestionIndex] === i"
                   [class.bg-blue-600]="selectedAnswers[currentQuestionIndex] === i">
                <span *ngIf="selectedAnswers[currentQuestionIndex] === i" class="text-white text-sm">โ</span>
              </div>
              <span class="text-lg text-gray-700">{{ option }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Navigation Buttons -->
      <div class="flex gap-4 justify-between">
        <button 
          (click)="prevQuestion()"
          [disabled]="currentQuestionIndex === 0"
          class="flex-1 px-6 py-3 bg-gray-200 text-gray-800 rounded-lg font-bold disabled:opacity-50">
          ุงูุณุงุจู
        </button>
        <button 
          *ngIf="currentQuestionIndex < exam.questions.length - 1"
          (click)="nextQuestion()"
          class="flex-1 px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-bold transition">
          ุงูุชุงูู
        </button>
        <button 
          *ngIf="currentQuestionIndex === exam.questions.length - 1"
          (click)="submitExam()"
          class="flex-1 px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-bold transition">
          ุฅููุงุก ุงูุงุฎุชุจุงุฑ
        </button>
      </div>
    </div>
  </div>

  <!-- Results Screen -->
  <div *ngIf="!loading && exam && submitted" class="max-w-2xl mx-auto p-6 min-h-[calc(100vh-100px)] flex items-center">
    <div class="bg-white rounded-xl shadow-lg p-8 w-full text-center">
      <div class="mb-8">
        <div class="inline-flex items-center justify-center w-24 h-24 rounded-full mb-6"
             [class.bg-green-100]="isPassed()"
             [class.bg-red-100]="!isPassed()">
          <span class="text-5xl" [ngClass]="isPassed() ? '๐' : 'โ'"></span>
        </div>
      </div>

      <h2 class="text-4xl font-bold mb-2" [ngClass]="isPassed() ? 'text-green-600' : 'text-red-600'">
        {{ isPassed() ? 'ูุจุฑูู! ูุฌุญุช' : 'ููุฃุณูุ ูู ุชูุฌุญ' }}
      </h2>

      <div class="text-6xl font-bold text-blue-600 my-8">
        {{ score }}/{{ exam.questions.length }}
      </div>

      <div class="bg-gray-100 rounded-lg p-6 mb-8">
        <p class="text-gray-700 mb-2">ุฏุฑุฌุฉ ุงููุฌุงุญ ุงููุทููุจุฉ: <span class="font-bold">{{ exam.passingScore }}/{{ exam.questions.length }}</span></p>
        <p class="text-gray-700">ูุฏุฉ ุงูุฅุฌุงุจุฉ: <span class="font-bold">{{ exam.duration }} ุฏูููุฉ</span></p>
      </div>

      <div class="space-y-4">
        <button 
          routerLink="/exams"
          class="w-full px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-bold transition">
          ุงูุนูุฏุฉ ููุงุฎุชุจุงุฑุงุช
        </button>
        <button 
          routerLink="/"
          class="w-full px-6 py-3 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-lg font-bold transition">
          ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ
        </button>
      </div>
    </div>
  </div>
</div>
